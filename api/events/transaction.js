const smart = require("../lib/smartcontract");
const txController = require("../../db/controllers/tx");

eventEmitter.on('addTransaction', async(data)=>{
    let validateData = await smart.validateAnswerTransactionFromHash(data.tx.hash)
    console.log("TX emmit: ", data)
    await txController.create({
         hash:data.tx.hash,
         status: data.receipt.status,
         address:data.tx.to,
         from:data.tx.from,
         contract_type:0,
         event_type:0,
         block_number:data.tx.blockNumber,
         method:validateData.method,
    }).catch(err=> {
        console.log("Error insert transaction", err.message);
         }
     )
    console.log("TX_REG: ", data.tx.from, validateData.method, data.tx.blockNumber, data.tx.to, data.tx.hash)
})

/***
 *   tx: {
    blockHash: '0xff0d9b0ef8ae55d1e3c93760ff085ed97c2a129a0ea6f0654e2d77de95df24f6',
    blockNumber: 13388247,
    from: '0x33295b5De6e00d45f68a3a7712cb16940bFebEfE',
    gas: 66157,
    gasPrice: '10000000000',
    hash: '0x2dce5305324fcb21d97926e1eb2466b1fa5b6560774006d17fa4231ffd840ecd',
    input: '0x095ea7b30000000000000000000000008302c22142d8d12e3a3a4fe5a0f86a6610a6825400000000000000000000000000000000000000000000000000005af3107a4000',
    nonce: 325,
    to: '0x650ec7bB36C924EdFB0C18C8d8C1A1FCa50e83C2',
    transactionIndex: 0,
    value: '0',
    type: 0,
    v: '0xe5',
    r: '0x1e91fb5c1341268c2a72f212b46588d650ebf3383988885bd080f89ec80b06e3',
    s: '0x392b08115d884d5c8cddece6ab6f74a526f8ee552a72886e1e0ea89f01436efa'
  },
 receipt: {
    blockHash: '0xff0d9b0ef8ae55d1e3c93760ff085ed97c2a129a0ea6f0654e2d77de95df24f6',
    blockNumber: 13388247,
    contractAddress: null,
    cumulativeGasUsed: 44105,
    from: '0x33295b5de6e00d45f68a3a7712cb16940bfebefe',
    gasUsed: 44105,
    logs: [ [Object] ],
    logsBloom: '0x00200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000001000000000000000000200000000000000000000000000000000000000000000000000000004000002000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000020000000000000000000000400000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000010000000000000000000000000000000000000080000000000000000000000',
    status: true,
    to: '0x650ec7bb36c924edfb0c18c8d8c1a1fca50e83c2',
    transactionHash: '0x2dce5305324fcb21d97926e1eb2466b1fa5b6560774006d17fa4231ffd840ecd',
    transactionIndex: 0,
    type: '0x0'
  }

 /////////////// Route
 tx: {
    blockHash: '0xaa7f500037ca8cd8ee9192a8ef970d75f75bebe74ebfa56ceab1d91d07c066ec',
    blockNumber: 13389039,
    from: '0x33295b5De6e00d45f68a3a7712cb16940bFebEfE',
    gas: 182023,
    gasPrice: '10000000000',
    hash: '0x637500e15febd35b590de2c6c07f7b9f89cec3c4912717f353bf0dd11abb945d',
    input: '0x5c11d79500000000000000000000000000000000000000000000000000005af3107a400000000000000000000000000000000000000000000000000000031826d3bfa30d00000000000000000000000000000000000000000000000000000000000000a000000000000000000000000033295b5de6e00d45f68a3a7712cb16940bfebefe00000000000000000000000000000000000000000000000000000022ecb25c000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000650ec7bb36c924edfb0c18c8d8c1a1fca50e83c2000000000000000000000000c3142810057713bb7651240c86671c7966be75fd',
    nonce: 328,
    to: '0x8302c22142d8d12e3a3a4fe5a0f86a6610a68254',
    transactionIndex: 3,
    value: '0',
    type: 0,
    v: '0xe6',
    r: '0x6473eb85c28ffa966f152e2b1d7164ea67d08b876f2b30bf782960e7535717f8',
    s: '0x4800b10a204fa1ac33ef87503f70c0761033085be069596b83edae4549563eb0'
  },
 receipt: {
    blockHash: '0xaa7f500037ca8cd8ee9192a8ef970d75f75bebe74ebfa56ceab1d91d07c066ec',
    blockNumber: 13389039,
    contractAddress: null,
    cumulativeGasUsed: 470990,
    from: '0x33295b5de6e00d45f68a3a7712cb16940bfebefe',
    gasUsed: 102149,
    logs: [ [Object], [Object], [Object], [Object], [Object] ],
    logsBloom: '0x00200000000000000000000080000000000000000020000000000000000000000000000000000000000000000000000040000001000000004480000000200000000000000000000000000108000000200000000000000004004020002000000000000000000000000000000000000200000000000000000000000010000000000000002000000000000000000000000000000000000000080000004000000000020000000000000000000000400000000000000000000000000000000000000000000002100000001000000000000000000000000000001000000000000000000010000000000000000000000000000000000000080000000000000000000000',
    status: true,
    to: '0x8302c22142d8d12e3a3a4fe5a0f86a6610a68254',
    transactionHash: '0x637500e15febd35b590de2c6c07f7b9f89cec3c4912717f353bf0dd11abb945d',
    transactionIndex: 3,
    type: '0x0'
  }
 }


 */